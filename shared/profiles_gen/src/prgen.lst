%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                          S u m m a r y   R e p o r t
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Compilation
-----------
File     : /global/u2/b/bassem/gyro-EP/shared/profiles_gen/src/prgen.f90
Compiled : 01/19/21  15:35:04
Compiler : Version 9.1.0
Ftnlx    : Version 9.1.0 
Target   : x86-64
Command  : ftn_driver.exe -hcpu=haswell -hdynamic -D__CRAYXC -D__CRAY_HASWELL
           -D__CRAYXT_COMPUTE_LINUX_TARGET -hnetwork=aries -hnoomp -em
           -J/global/homes/b/bassem/gyro-EP/modules -sreal64 -eD -Ktrap=fp -m1
           -Rbcdps -G0 -I/opt/cray/pe/netcdf/4.6.3.2/CRAYCLANG/9.0/include
           -c prgen.f90
           -I/opt/cray/pe/cce/9.1.0/cce-clang/x86_64/lib/clang/9.0.0/include
           -I/opt/cray/pe/cce/9.1.0/cce/x86_64/include/craylibs -I/usr/include
           -I/usr/include -I/opt/cray/pe/fftw/3.3.8.4/haswell/include
           -I/opt/cray/pe/libsci/19.06.1/CRAY/9.0/x86_64/include
           -I/opt/cray/pe/mpt/7.7.10/gni/mpich-cray/9.0/include
           -I/opt/cray/pe/hdf5/1.10.5.2/cray/9.0/include
           -I/opt/cray/pe/netcdf/4.6.3.2/cray/9.0/include
           -I/opt/cray/rca/2.2.20-7.0.1.1_4.53__g8e3fb5b.ari/include
           -I/opt/cray/alps/6.6.58-7.0.1.1_6.10__g437d88db.ari/include
           -I/opt/cray/xpmem/2.2.20-7.0.1.1_4.14__g0475745.ari/include
           -I/opt/cray/gni-headers/5.0.12.0-7.0.1.1_6.32__g3b1768f.ari/include
           -I/opt/cray/dmapp/7.1.1-7.0.1.1_4.54__g38cf134.ari/include
           -I/opt/cray/pe/pmi/5.0.14/include
           -I/opt/cray/ugni/6.0.14.0-7.0.1.1_7.40__ge78e5b0.ari/include
           -I/opt/cray/udreg/2.3.2-7.0.1.1_3.38__g8175d3d.ari/include
           -I/opt/cray/wlm_detect/1.3.3-7.0.1.1_4.16__g7109084.ari/include
           -I/opt/cray/krca/2.2.6-7.0.1.1_5.39__gb641b12.ari/include
           -I/opt/cray-hss-devel/9.0.0/include
Program
  Units  : PRGEN

ftnlx report
------------
Source   : /global/u2/b/bassem/gyro-EP/shared/profiles_gen/src/prgen.f90
Date     : 01/19/2021  15:35:04


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                          S o u r c e   L i s t i n g
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    1.    !-------------------------------------------------------------------
    2.    ! prgen.f90
    3.    !
    4.    ! PURPOSE:
    5.    !  Generate input.profiles from prexisting data.  This executable is
    6.    !  managed and called by gacode/shared/bin/profiles_gen.
    7.    !
    8.    !  Autodetected profile formats:
    9.    !   GACODE      (input.profiles)
   10.    !   ITERDB      (text iterdb)
   11.    !   ITERDBNC    (netCDF iterdb)
   12.    !   SWIM        (plasmastate)
   13.    !   PFILE       (peqdsk)
   14.    !   CORSICA     (Corsica) 
   15.    !   UFILE       (ITPA profile database format)
   16.    !
   17.    !  Autodetected geometry formats:
   18.    !   GFILE       (geqdsk equilibrium data)
   19.    !   DSKGATO_OLD (old-type dskgato flux-surface data)
   20.    !   DSKGATO_NEW (new-type dskgato flux-surface data)
   21.    !--------------------------------------------------------------------
   22.    
   23.    program prgen
   24.    
   25.      use prgen_globals
   26.      use EXPRO_interface
   27.    
   28.      !--------------------------------------------------
   29.      implicit none
   30.      !--------------------------------------------------
   31.    
   32.      !--------------------------------------------------
   33.      ! Parse the config file
   34.      !
   35.      open(unit=1,file='.config',status='old')
   36.      read(1,'(a)') date
   37.      read(1,'(a)') raw_data_file
   38.      read(1,'(a)') raw_data_type
   39.      read(1,'(a)') cer_file
   40.      read(1,*) efit_method
   41.      read(1,*) noq_flag
   42.      read(1,*) nop_flag
   43.      read(1,*) verbose_flag
   44.      read(1,*) gmerge_flag
   45.      read(1,*) ipccw
   46.      read(1,*) btccw
   47.      read(1,*) nfourier
   48.      read(1,*) n_null
   49.      read(1,*) lump_fast_flag
   50.      read(1,*) reorder_vec(:)
   51.      read(1,*) n_lump
   52.      allocate(lump_vec(n_lump))
   53.      read(1,*) lump_vec(:)
   54.      read(1,*) n_ion_sanitize
   55.      allocate(ion_sanitize(n_ion_sanitize))
   56.      read(1,*) ion_sanitize(:)
   57.      close(1)
   58.      !--------------------------------------------------
   59.      
   60.      !------------------------------------------------------------------
   61.      ! Read the iterdb file and define standard variables.
   62.      !
   63.      ! Note that nx will be the experimental vector length in ALL cases:
   64.      !
   65.      if (trim(raw_data_type) == 'GACODE') then
   66.    
   67.         ! Note (we may or may not have gmerge_flag == 1
   68.         print '(a)','INFO: (prgen) Assuming input.profiles (GACODE) format.'
   69.    
   70.         call prgen_read_inputprofiles
   71.    
   72.         format_type = 7
   73.    
   74.      else if (trim(raw_data_type) == 'null') then
   75.    
   76.         ! Pure gfile parsing
   77.    
   78.         format_type = 0
   79.    
   80.         ! Minimal processing required to merge gfile data into otherwise
   81.         ! empty input.profiles output file.
   82.         call prgen_read_null
   83.    
   84.      else if (trim(raw_data_type) == 'ITERDBNC') then
   85.    
   86.         ! New NetCDF format
   87.         print '(a)','INFO: (prgen) Assuming iterdb NetCDF format.'
   88.    
   89.         format_type = 1
   90.    
   91.         call prgen_read_iterdb_nc
   92.    
   93.      else if (trim(raw_data_type) == 'SWIM') then
   94.    
   95.         ! Plasmastate format
   96.         print '(a)','INFO: (prgen) Assuming SWIM (plasmastate) format.'
   97.    
   98.         format_type = 2
   99.    
  100.         call prgen_read_plasmastate
  101.    
  102.      else if (trim(raw_data_type) == 'PFILE') then
  103.    
  104.         ! peqdsk format
  105.         print '(a)','INFO: (prgen) Assuming PFILE (peqdsk) format.'
  106.    
  107.         format_type = 3
  108.    
  109.         call prgen_read_peqdsk
  110.         
  111.      else if (trim(raw_data_type) == 'CORSICA') then
  112.    
  113.         ! corsica format
  114.         print '(a)','INFO: (prgen) Assuming CORSICA format.'
  115.    
  116.         format_type = 5
  117.    
  118.         call prgen_read_corsica
  119.    
  120.      else if (trim(raw_data_type) == 'UFILE') then
  121.    
  122.         ! UFILE format
  123.         print '(a)','INFO: (prgen) Assuming UFILE format.'
  124.    
  125.         format_type = 6
  126.    
  127.         call prgen_read_ufile
  128.    
  129.      else if (trim(raw_data_type) == 'ITERDB') then
  130.    
  131.         ! Old text format
  132.         print '(a)','INFO: (prgen) Assuming old iterdb text format.'
  133.    
  134.         format_type = 1
  135.    
  136.         call prgen_read_iterdb 
  137.    
  138.      else
  139.    
  140.         ! No case matched
  141.    
  142.         print '(a)','ERROR: (prgen) Unmatched options.'
  143.         stop
  144.    
  145.      endif
  146.      !------------------------------------------------------------------
  147.      
  148.      
  149.      !---------------------------------------------------
  150.      ! Read the GATO file for "better" geometry.  At this
  151.      ! point, GATO has already run and we are just reading 
  152.      ! the output.
  153.      !
  154.      select case (efit_method)
  155.      case (1)
  156.         ! Use geometry data contained in profile data 
  157.         print '(a)','INFO: (prgen) Using original geometry data.'
  158.      case (2)
  159.         ! Use GATO-EFIT mapper
  160.         call prgen_read_gato
  161.         print '(a)','INFO: (prgen) Wrote input.profiles.geo.'
  162.      case (3)
  163.         ! Use OMFIT-EFIT mapper
  164.         call prgen_read_omfit
  165.         print '(a)','INFO: (prgen) Wrote input.profiles.geo'
  166.      case (4,5)
  167.         ! Use DSKGATO data
  168.         call prgen_read_dskgato
  169.         print '(a)','INFO: (prgen) Wrote input.profiles.geo'
  170.      end select
  171.      !---------------------------------------------------
  172.    
  173.      select case (format_type)
  174.    
  175.      case (0)
  176.         call prgen_map_null
  177.      case (1)
  178.         call prgen_map_iterdb
  179.      case (2) 
  180.         call prgen_map_plasmastate
  181.      case (3) 
  182.         call prgen_map_peqdsk
  183.      case (5) 
  184.         call prgen_map_corsica
  185.      case (6)
  186.         call prgen_map_ufile
  187.      case (7)
  188.         if (gmerge_flag == 1) then
  189.            call prgen_map_inputprofiles
  190.         endif
  191.    
  192.      end select
  193.    
  194.      ! Handle special case of generating input.profiles.extra
  195.      if (format_type == 7 .and. gmerge_flag == 0) then
  196.         call EXPRO_write_derived(1,'input.profiles.extra')
  197.         print '(a)','INFO: (prgen) Wrote input.profiles.extra.'
  198.         call prgen_write
  199.      else
  200.         call prgen_write
  201.      endif
  202.      call EXPRO_alloc('./',0)
  203.    
  204.      ! Successful completion
  205.      open(unit=1,file='success',status='replace')
  206.      write(1,*) 1
  207.      close(1)
  208.    
  209.    end program prgen


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                         E x t e r n a l   R e p o r t
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Name  Messages
----  --------
EXPRO_ALLOC
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 202, file prgen.f90)

Name  Messages
----  --------
EXPRO_INTERFACE
      Defined as:  No definitions.

      Used By:     PRGEN

Name  Messages
----  --------
EXPRO_WRITE_DERIVED
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 196, file prgen.f90)

Name  Messages
----  --------
PRGEN
      Defined as:  Program (line 23, file prgen.f90)

      Calls:       TRIM(Intrinsic) (Line 65, file prgen.f90)
                   TRIM(Intrinsic) (Line 74, file prgen.f90)
                   TRIM(Intrinsic) (Line 84, file prgen.f90)
                   TRIM(Intrinsic) (Line 93, file prgen.f90)
                   TRIM(Intrinsic) (Line 102, file prgen.f90)
                   TRIM(Intrinsic) (Line 111, file prgen.f90)
                   TRIM(Intrinsic) (Line 120, file prgen.f90)
                   TRIM(Intrinsic) (Line 129, file prgen.f90)
                   PRGEN_READ_INPUTPROFILES (Line 70, file prgen.f90)
                   PRGEN_READ_NULL (Line 82, file prgen.f90)
                   PRGEN_READ_ITERDB_NC (Line 91, file prgen.f90)
                   PRGEN_READ_PLASMASTATE (Line 100, file prgen.f90)
                   PRGEN_READ_PEQDSK (Line 109, file prgen.f90)
                   PRGEN_READ_CORSICA (Line 118, file prgen.f90)
                   PRGEN_READ_UFILE (Line 127, file prgen.f90)
                   PRGEN_READ_ITERDB (Line 136, file prgen.f90)
                   PRGEN_READ_GATO (Line 160, file prgen.f90)
                   PRGEN_READ_OMFIT (Line 164, file prgen.f90)
                   PRGEN_READ_DSKGATO (Line 168, file prgen.f90)
                   PRGEN_MAP_NULL (Line 176, file prgen.f90)
                   PRGEN_MAP_ITERDB (Line 178, file prgen.f90)
                   PRGEN_MAP_PLASMASTATE (Line 180, file prgen.f90)
                   PRGEN_MAP_PEQDSK (Line 182, file prgen.f90)
                   PRGEN_MAP_CORSICA (Line 184, file prgen.f90)
                   PRGEN_MAP_UFILE (Line 186, file prgen.f90)
                   PRGEN_MAP_INPUTPROFILES (Line 189, file prgen.f90)
                   EXPRO_WRITE_DERIVED (Line 196, file prgen.f90)
                   PRGEN_WRITE (Line 198, file prgen.f90)
                   PRGEN_WRITE (Line 200, file prgen.f90)
                   EXPRO_ALLOC (Line 202, file prgen.f90)

        Uses:      PRGEN_GLOBALS
                   EXPRO_INTERFACE

Name  Messages
----  --------
PRGEN_GLOBALS
      Defined as:  No definitions.

      Used By:     PRGEN

Name  Messages
----  --------
PRGEN_MAP_CORSICA
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 184, file prgen.f90)

Name  Messages
----  --------
PRGEN_MAP_INPUTPROFILES
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 189, file prgen.f90)

Name  Messages
----  --------
PRGEN_MAP_ITERDB
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 178, file prgen.f90)

Name  Messages
----  --------
PRGEN_MAP_NULL
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 176, file prgen.f90)

Name  Messages
----  --------
PRGEN_MAP_PEQDSK
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 182, file prgen.f90)

Name  Messages
----  --------
PRGEN_MAP_PLASMASTATE
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 180, file prgen.f90)

Name  Messages
----  --------
PRGEN_MAP_UFILE
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 186, file prgen.f90)

Name  Messages
----  --------
PRGEN_READ_CORSICA
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 118, file prgen.f90)

Name  Messages
----  --------
PRGEN_READ_DSKGATO
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 168, file prgen.f90)

Name  Messages
----  --------
PRGEN_READ_GATO
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 160, file prgen.f90)

Name  Messages
----  --------
PRGEN_READ_INPUTPROFILES
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 70, file prgen.f90)

Name  Messages
----  --------
PRGEN_READ_ITERDB
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 136, file prgen.f90)

Name  Messages
----  --------
PRGEN_READ_ITERDB_NC
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 91, file prgen.f90)

Name  Messages
----  --------
PRGEN_READ_NULL
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 82, file prgen.f90)

Name  Messages
----  --------
PRGEN_READ_OMFIT
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 164, file prgen.f90)

Name  Messages
----  --------
PRGEN_READ_PEQDSK
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 109, file prgen.f90)

Name  Messages
----  --------
PRGEN_READ_PLASMASTATE
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 100, file prgen.f90)

Name  Messages
----  --------
PRGEN_READ_UFILE
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 127, file prgen.f90)

Name  Messages
----  --------
PRGEN_WRITE
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 198, file prgen.f90)
                   PRGEN (Line 200, file prgen.f90)

Name  Messages
----  --------
TRIM(Intrinsic)
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN (Line 65, file prgen.f90)
                   PRGEN (Line 74, file prgen.f90)
                   PRGEN (Line 84, file prgen.f90)
                   PRGEN (Line 93, file prgen.f90)
                   PRGEN (Line 102, file prgen.f90)
                   PRGEN (Line 111, file prgen.f90)
                   PRGEN (Line 120, file prgen.f90)
                   PRGEN (Line 129, file prgen.f90)

Name  Messages
----  --------
_F90_TRIM(Intrinsic)
      Defined as:  No definitions.

                   No calls.  It is not called and does not use any procedure.

      Interface:   None


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
