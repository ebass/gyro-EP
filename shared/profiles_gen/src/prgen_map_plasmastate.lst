%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                          S u m m a r y   R e p o r t
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Compilation
-----------
File     : /global/u2/b/bassem/gyro-EP/shared/profiles_gen/src/prgen_map_plasmastate.f90
Compiled : 01/19/21  15:34:55
Compiler : Version 9.1.0
Ftnlx    : Version 9.1.0 
Target   : x86-64
Command  : ftn_driver.exe -hcpu=haswell -hdynamic -D__CRAYXC -D__CRAY_HASWELL
           -D__CRAYXT_COMPUTE_LINUX_TARGET -hnetwork=aries -hnoomp -em
           -J/global/homes/b/bassem/gyro-EP/modules -sreal64 -eD -Ktrap=fp -m1
           -Rbcdps -G0 -I/opt/cray/pe/netcdf/4.6.3.2/CRAYCLANG/9.0/include
           -c prgen_map_plasmastate.f90
           -I/opt/cray/pe/cce/9.1.0/cce-clang/x86_64/lib/clang/9.0.0/include
           -I/opt/cray/pe/cce/9.1.0/cce/x86_64/include/craylibs -I/usr/include
           -I/usr/include -I/opt/cray/pe/fftw/3.3.8.4/haswell/include
           -I/opt/cray/pe/libsci/19.06.1/CRAY/9.0/x86_64/include
           -I/opt/cray/pe/mpt/7.7.10/gni/mpich-cray/9.0/include
           -I/opt/cray/pe/hdf5/1.10.5.2/cray/9.0/include
           -I/opt/cray/pe/netcdf/4.6.3.2/cray/9.0/include
           -I/opt/cray/rca/2.2.20-7.0.1.1_4.53__g8e3fb5b.ari/include
           -I/opt/cray/alps/6.6.58-7.0.1.1_6.10__g437d88db.ari/include
           -I/opt/cray/xpmem/2.2.20-7.0.1.1_4.14__g0475745.ari/include
           -I/opt/cray/gni-headers/5.0.12.0-7.0.1.1_6.32__g3b1768f.ari/include
           -I/opt/cray/dmapp/7.1.1-7.0.1.1_4.54__g38cf134.ari/include
           -I/opt/cray/pe/pmi/5.0.14/include
           -I/opt/cray/ugni/6.0.14.0-7.0.1.1_7.40__ge78e5b0.ari/include
           -I/opt/cray/udreg/2.3.2-7.0.1.1_3.38__g8175d3d.ari/include
           -I/opt/cray/wlm_detect/1.3.3-7.0.1.1_4.16__g7109084.ari/include
           -I/opt/cray/krca/2.2.6-7.0.1.1_5.39__gb641b12.ari/include
           -I/opt/cray-hss-devel/9.0.0/include
Program
  Units  : PRGEN_MAP_PLASMASTATE

ftnlx report
------------
Source   : /global/u2/b/bassem/gyro-EP/shared/profiles_gen/src/prgen_map_plasmastate.f90
Date     : 01/19/2021  15:34:57


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                          S o u r c e   L i s t i n g
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    1.    !--------------------------------------------------------------
    2.    ! prgen_map_plasmastate.f90
    3.    !
    4.    ! PURPOSE:
    5.    !  Map native plasmastate data onto input.profiles standard.
    6.    !
    7.    ! NOTES:
    8.    !  See prgen_map_iterdb.f90 for analogous routine for 
    9.    !  iterbd data.
   10.    !--------------------------------------------------------------
   11.    
   12.    subroutine prgen_map_plasmastate
   13.    
   14.      use prgen_globals
   15.      use EXPRO_interface
   16.    
   17.      implicit none
   18.    
   19.      integer :: i,j
   20.      integer :: ip,ix
   21.      real, dimension(nx) :: dphidpsi
   22.      real, dimension(:), allocatable :: f1_therm,f2_therm
   23.      real, dimension(:), allocatable :: f1_lump,f2_lump,f3_lump
   24.      real, dimension(:), allocatable :: f1_fast,f2_fast,f3_fast,f4_fast
   25.      real :: z_eff_lump
   26.      real :: m_eff_lump
   27.    
   28.      !--------------------------------------------------------------------
   29.      ! Calculate integrated powers from input sources
   30.      !
   31.      pow_e(1)     = 0.0
   32.      pow_i(1)     = 0.0
   33.      pow_ei(1)    = 0.0
   34.      flow_mom(1)  = 0.0
   35.      flow_beam(1) = 0.0
   36.    
   37.      pow_e_fus(1) = 0.0 
   38.      pow_i_fus(1) = 0.0
   39.      pow_e_sync(1) = 0.0
   40.      pow_e_brem(1) = 0.0
   41.      pow_e_line(1) = 0.0
   42.    
   43.      pow_e_ohm(1) = 0.0
   44.      pow_e_nb(1)  = 0.0
   45.      pow_i_nb(1)  = 0.0
   46.      pow_e_rf(1)  = 0.0
   47.      pow_i_rf(1)  = 0.0
   48.    
   49.      do i=2,nx
   50.    
   51.         ! Total powers to electrons and ions "per zone"
   52.         ! Integrated power is thus a partial sum.
   53.         ! Factor of 1e-6 converts plasmastate (W) to input.profiles (MW).
   54.    
   55.         pow_e(i) = pow_e(i-1)+1e-6*plst_pe_trans(i-1)
   56.         pow_i(i) = pow_i(i-1)+1e-6*plst_pi_trans(i-1)
   57.    
   58.         ! Collisional exchange
   59.         !
   60.         ! plst_qie : power from ions to electrons
   61.         ! pow_ei   : power from electrons to ions
   62.         ! 
   63.         ! Thus, we need negative sign here:
   64.         pow_ei(i) = pow_ei(i-1)-1e-6*plst_qie(i-1)
   65.    
   66.         ! Reactor power breakdown
   67.    
   68.         pow_e_fus(i) = pow_e_fus(i-1)+1e-6*plst_pfuse(i-1)
   69.         pow_i_fus(i) = pow_i_fus(i-1)+1e-6*(plst_pfusi(i-1)+plst_pfusth(i-1))
   70.    
   71.         pow_e_ohm(i) = pow_e_ohm(i-1)+1e-6*plst_pohme(i-1)
   72.         pow_e_nb(i)  = pow_e_nb(i-1)+1e-6*plst_pbe(i-1)
   73.         pow_i_nb(i)  = pow_i_nb(i-1)+1e-6*(plst_pbi(i-1)+plst_pbth(i-1))
   74.         pow_e_rf(i)  = pow_e_rf(i-1)+1e-6*(plst_peech(i-1)+plst_pmine(i-1))
   75.         pow_i_rf(i)  = pow_i_rf(i-1)+1e-6*(plst_pmini(i-1)+plst_pminth(i-1)+plst_picth(i-1))
   76.    
   77.         pow_e_sync(i) = pow_e_sync(i-1)+1e-6*plst_prad_cy(i-1)
   78.         pow_e_brem(i) = pow_e_brem(i-1)+1e-6*plst_prad_br(i-1)
   79.         pow_e_line(i) = pow_e_line(i-1)+1e-6*plst_prad_li(i-1)
   80.    
   81.         ! Momentum source
   82.         !
   83.         ! tq_trans already in Nm.
   84.         ! COORDINATES: -ipccw accounts for plasmastate toroidal angle convention
   85.         flow_mom(i) = flow_mom(i-1)+plst_tq_trans(i-1)*(-ipccw)
   86.    
   87.         ! Particle source
   88.         !
   89.         ! MW/keV = 0.624e22/s
   90.    
   91.         flow_beam(i) = flow_beam(i-1)+plst_sn_trans(i-1)/0.624e22
   92.    
   93.      enddo
   94.    
   95.      ! Check radiated powers
   96.      if (minval(pow_e_sync) < 0.0) then
ftn-6297 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 96 
  A loop starting at line 96 was not vectorized because a recurrence was found at line 96.

   97.         print '(a)','WARNING: (prgen) Found negative sync radiation.'
   98.      endif
   99.      if (minval(pow_e_brem) < 0.0) then
ftn-6297 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 99 
  A loop starting at line 99 was not vectorized because a recurrence was found at line 99.

  100.         print '(a)','WARNING: (prgen) Found negative brem radiation.'
  101.      endif
  102.      if (minval(pow_e_line) < 0.0) then
ftn-6297 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 102 
  A loop starting at line 102 was not vectorized because a recurrence was found at line 102.

  103.         print '(a)','WARNING: (prgen) Found negative line radiation.'
  104.      endif
  105.    
  106.      ! Manage auxiliary powers
  107.      if (true_aux_flag == 1) then
  108.         pow_e_aux(:) = pow_e_ohm+pow_e_nb+pow_e_rf
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 108 
  A loop starting at line 108 was not vectorized because it contains a call to a subroutine or function on line 108.

  109.         pow_i_aux(:) =          +pow_i_nb+pow_i_rf
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 109 
  A loop starting at line 109 was not vectorized because it contains a call to a subroutine or function on line 109.

  110.         print '(a)','INFO: (prgen) Setting aux. power as ohmic+NB+RF.'
  111.      else
  112.         pow_e_aux(:) = pow_e-(pow_e_fus-pow_ei-pow_e_sync-pow_e_brem-pow_e_line)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 112 
  A loop starting at line 112 was not vectorized because it contains a call to a subroutine or function on line 112.

  113.         pow_i_aux(:) = pow_i-(pow_i_fus+pow_ei)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 113 
  A loop starting at line 113 was not vectorized because it contains a call to a subroutine or function on line 113.

  114.         print '(a)','INFO: (prgen) Setting aux. power as total-fus-rad.'
  115.      endif
  116.      !
  117.      pow_e_err = abs(1.0-(pow_e_fus(nx)+pow_e_aux(nx)-pow_ei(nx)- &
  118.           pow_e_sync(nx)-pow_e_brem(nx)-pow_e_line(nx))/pow_e(nx))
  119.      pow_i_err = abs(1.0-(pow_i_fus(nx)+pow_i_aux(nx)+pow_ei(nx))/pow_i(nx))
  120.      !--------------------------------------------------------------------
  121.    
  122.      !--------------------------------------------------------------------
  123.      ! COORDINATES: set sign of poloidal flux 
  124.      dpsi(:) = abs(dpsi(:))*(-ipccw)
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 124 
  A loop starting at line 124 was not vectorized because it contains a reference to a non-vector intrinsic on line 124.

  125.      ! 
  126.      ! Convert potential to Omega
  127.      !
  128.      ! omega0 = -c d(Phi)/dpsi
  129.      !
  130.      ! phi [statvolt] = (10/3) phi (kV)
  131.      ! psi [Maxwell]  = 10^8 psi [Weber]
  132.      ! c [cm/s] = 2.9979e10
  133.      !
  134.      ! NOTE: dpsi = plst_psipol-plst_psipol(1)
  135.      !
  136.      call bound_deriv(dphidpsi,plst_epot,dpsi,nx)
  137.      !
  138.      omega0 = -2.9979e10*dphidpsi*(10.0/3.0)/1e8
ftn-6209 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 138 
  A loop starting at line 138 was partially vectorized.

  139.      !--------------------------------------------------------------------
  140.    
  141.      !-------------------------------------------------------------------------------
  142.      ! Lump main ions and/or fast ions
  143.      !
  144.      allocate(f1_therm(nx))
  145.      allocate(f1_fast(nx))
  146.      allocate(f1_lump(nx))
  147.      allocate(f2_therm(nx))
  148.      allocate(f2_fast(nx))
  149.      allocate(f2_lump(nx))
  150.      allocate(f3_fast(nx))
  151.      allocate(f3_lump(nx))
  152.      allocate(f4_fast(nx))
  153.      !
  154.      f1_therm(:) = 0.0
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 154 
  A loop starting at line 154 was not vectorized because it contains a reference to a non-vector intrinsic on line 154.

  155.      f2_therm(:) = 0.0
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 155 
  A loop starting at line 155 was not vectorized because it contains a reference to a non-vector intrinsic on line 155.

  156.      do i=2,plst_dp1_nspec_th
  157.         f1_therm(:) = f1_therm(:)+plst_ns(:,i)*plst_q_all(i)/1.6022e-19  
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 157 
  A loop starting at line 157 was not vectorized because it contains a call to a subroutine or function on line 157.

  158.         f2_therm(:) = f2_therm(:)+plst_ns(:,i)*(plst_q_all(i)/1.6022e-19)**2   
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 158 
  A loop starting at line 158 was not vectorized because it contains a call to a subroutine or function on line 158.

  159.      enddo
  160.    
  161.      print '(a)','INFO: (prgen) Found these ion species:'
  162.      do i=2,plst_dp1_nspec_all
  163.         print '(t6,i2,1x,a)', i-1,trim(plst_all_name(i))
  164.      enddo
  165.    
  166.      f1_fast(:) = 0.0
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 166 
  A loop starting at line 166 was not vectorized because it contains a reference to a non-vector intrinsic on line 166.

  167.      f2_fast(:) = 0.0
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 167 
  A loop starting at line 167 was not vectorized because it contains a reference to a non-vector intrinsic on line 167.

  168.      f3_fast(:) = 0.0
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 168 
  A loop starting at line 168 was not vectorized because it contains a reference to a non-vector intrinsic on line 168.

  169.      f4_fast(:) = 0.0
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 169 
  A loop starting at line 169 was not vectorized because it contains a reference to a non-vector intrinsic on line 169.

  170.      do i=plst_dp1_nspec_th+1,ntop
  171.         f1_fast(:) = f1_fast(:)+plst_ns(:,i)*plst_q_all(i)/1.6022e-19 
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 171 
  A loop starting at line 171 was not vectorized because it contains a call to a subroutine or function on line 171.

  172.         f2_fast(:) = f2_fast(:)+plst_ns(:,i)*(plst_q_all(i)/1.6022e-19)**2
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 172 
  A loop starting at line 172 was not vectorized because it contains a call to a subroutine or function on line 172.

  173.         f3_fast(:) = f3_fast(:)+plst_ns(:,i)*plst_m_all(i)*plst_q_all(i)/1.6022e-19
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 173 
  A loop starting at line 173 was not vectorized because it contains a call to a subroutine or function on line 173.

  174.         f4_fast(:) = f4_fast(:)+plst_ns(:,i)*plst_ts(:,i)*plst_q_all(i)/1.6022e-19
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 174 
  A loop starting at line 174 was not vectorized because it contains a call to a subroutine or function on line 174.

  175.      enddo
  176.    
  177.      ! Lump main ions
  178.      if (n_lump > 1) then
  179.    
  180.         f1_lump(:) = 0.0
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 180 
  A loop starting at line 180 was not vectorized because it contains a reference to a non-vector intrinsic on line 180.

  181.         f2_lump(:) = 0.0
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 181 
  A loop starting at line 181 was not vectorized because it contains a reference to a non-vector intrinsic on line 181.

  182.         f3_lump(:) = 0.0
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 182 
  A loop starting at line 182 was not vectorized because it contains a reference to a non-vector intrinsic on line 182.

  183.    
  184.         ! Add 1 to account for electrons at index 1
  185.         lump_vec(:) = lump_vec(:)+1
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 185 
  A loop starting at line 185 was not vectorized because it contains a reference to a non-vector intrinsic on line 185.

  186.         do j=1,n_lump
  187.            i = lump_vec(j)
  188.            ! f1 = sum_i ni*Zi
  189.            f1_lump(:) = f1_lump(:)+plst_ns(:,i)*plst_q_all(i)/1.6022e-19
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 189 
  A loop starting at line 189 was not vectorized because it contains a call to a subroutine or function on line 189.

  190.            ! f2 = sum_i ni*Zi^2
  191.            f2_lump(:) = f2_lump(:)+plst_ns(:,i)*(plst_q_all(i)/1.6022e-19)**2
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 191 
  A loop starting at line 191 was not vectorized because it contains a call to a subroutine or function on line 191.

  192.            ! f3 = sum_i ni*mi*Zi
  193.            f3_lump(:) = f3_lump(:)+plst_ns(:,i)*plst_m_all(i)*plst_q_all(i)/1.6022e-19
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 193 
  A loop starting at line 193 was not vectorized because it contains a call to a subroutine or function on line 193.

  194.         enddo
  195.    
  196.         z_eff_lump = nint(sum(f2_lump(:)/f1_lump(:))/nx)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 196 
  A loop starting at line 196 was not vectorized because it contains a call to a subroutine or function on line 196.

  197.    
  198.         ! Charge-density-weighted effective mass: sum_i (ni*mi*Zi)/(ni*Zi)
  199.         m_eff_lump = sum(f3_lump(:)/f1_lump(:))/nx
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 199 
  A loop starting at line 199 was not vectorized because it contains a call to a subroutine or function on line 199.

  200.    
  201.         ! Replace first lumped species with lumped density
  202.         plst_ns(:,lump_vec(1))     = f1_lump(:)/z_eff_lump 
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 202 
  A loop starting at line 202 was not vectorized because it contains a call to a subroutine or function on line 202.

  203.         plst_q_all(lump_vec(1))    = z_eff_lump*1.6022e-19  
  204.         plst_m_all(lump_vec(1))    = m_eff_lump  
  205.         plst_all_name(lump_vec(1)) = '[lumped]'
  206.    
  207.         ! Remove others and restack 
  208.         do j=2,n_lump
  209.            ix = lump_vec(j)-j+2
  210.            do i=ix+1,plst_dp1_nspec_all
  211.               plst_ns(:,i-1)  = plst_ns(:,i)
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 211 
  A loop starting at line 211 was not vectorized because it contains a reference to a non-vector intrinsic on line 211.

  212.               plst_ts(:,i-1)  = plst_ts(:,i)
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 212 
  A loop starting at line 212 was not vectorized because it contains a reference to a non-vector intrinsic on line 212.

  213.               plst_q_all(i-1) = plst_q_all(i)
  214.               plst_m_all(i-1) = plst_m_all(i)
  215.               plst_all_name(i-1) = plst_all_name(i)
  216.            enddo
  217.            plst_dp1_nspec_all = plst_dp1_nspec_all-1
  218.            plst_dp1_nspec_th = plst_dp1_nspec_th-1
  219.         enddo
  220.    
  221.      endif
  222.    
  223.      ! Recompute thermal fractions after lumping
  224.      f1_therm(:) = 0.0
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 224 
  A loop starting at line 224 was not vectorized because it contains a reference to a non-vector intrinsic on line 224.

  225.      f2_therm(:) = 0.0
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 225 
  A loop starting at line 225 was not vectorized because it contains a reference to a non-vector intrinsic on line 225.

  226.      do i=2,plst_dp1_nspec_th
  227.         f1_therm(:) = f1_therm(:)+plst_ns(:,i)*(plst_q_all(i)/1.6022e-19) 
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 227 
  A loop starting at line 227 was not vectorized because it contains a call to a subroutine or function on line 227.

  228.         f2_therm(:) = f2_therm(:)+plst_ns(:,i)*(plst_q_all(i)/1.6022e-19)**2  
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 228 
  A loop starting at line 228 was not vectorized because it contains a call to a subroutine or function on line 228.

  229.      enddo
  230.    
  231.      ! Lump fast ions
  232.      if (lump_fast_flag == 1) then
  233.    
  234.         z_eff_lump = nint(sum(f2_fast(:)/f1_fast(:))/nx)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 234 
  A loop starting at line 234 was not vectorized because it contains a call to a subroutine or function on line 234.

  235.         ! Charge-density-weighted effective mass: sum_i (ni*mi*Zi)/(ni*Zi)
  236.         m_eff_lump = sum(f3_fast(:)/f1_fast(:))/nx
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 236 
  A loop starting at line 236 was not vectorized because it contains a call to a subroutine or function on line 236.

  237.    
  238.         ! Replace first lumped species with lumped density
  239.         ix = plst_dp1_nspec_th+1 
  240.         plst_ns(:,ix)     = f1_fast(:)/z_eff_lump 
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 240 
  A loop starting at line 240 was not vectorized because it contains a call to a subroutine or function on line 240.

  241.         ! Charge-density-weighted effective temp: sum_i (ni*Ti*Zi)/(ni*Zi)
  242.         plst_ts(:,ix)     = f4_fast(:)/f1_fast(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 242 
  A loop starting at line 242 was not vectorized because it contains a call to a subroutine or function on line 242.

  243.         plst_q_all(ix)    = z_eff_lump*1.6022e-19  
  244.         plst_m_all(ix)    = m_eff_lump
  245.         plst_all_name(ix) = '[fast]'
  246.    
  247.         plst_dp1_nspec_all = ix
  248.    
  249.      endif
  250.    
  251.      plst_zeff(:) = (f2_therm(:)+f2_fast(:))/(f1_therm(:)+f1_fast(:))
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 251 
  A loop starting at line 251 was not vectorized because it contains a call to a subroutine or function on line 251.

  252.    
  253.      ! Compute the quasineutrality error with max 5 ions:
  254.    
  255.      quasi_err = 0.0
  256.      ix = min(plst_dp1_nspec_th+1,n_ion_max+1)
  257.      do i=1,nx
  258.         quasi_err = quasi_err+sum(plst_ns(i,2:ix)*plst_q_all(2:ix))
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 258 
  A loop starting at line 258 was not vectorized because it contains a reference to a non-vector intrinsic on line 258.

  259.      enddo
  260.      quasi_err = abs(quasi_err/sum(-plst_ns(:,1)*plst_q_all(1))-1.0)
ftn-6263 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 260 
  A loop starting at line 260 was not vectorized because it contains a reference to a non-vector intrinsic on line 260.

  261.    
  262.      deallocate(f1_therm,f2_therm)
  263.      deallocate(f1_lump,f2_lump,f3_lump)
  264.      deallocate(f1_fast,f2_fast,f3_fast,f4_fast)
  265.      !-------------------------------------------------------------------------------
  266.    
  267.      !---------------------------------------------------------
  268.      ! Map profile data into EXPRO interface variables
  269.      !
  270.      EXPRO_n_exp = nx
  271.      call EXPRO_alloc('./',1)
  272.      !
  273.      EXPRO_rho  = plst_rho
ftn-6209 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 273 
  A loop starting at line 273 was partially vectorized.

  274.      EXPRO_rmin = rmin(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 274 
  A loop starting at line 274 was not vectorized because it contains a call to a subroutine or function on line 274.

  275.      EXPRO_rmaj = rmaj(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 275 
  A loop starting at line 275 was not vectorized because it contains a call to a subroutine or function on line 275.

  276.      ! COORDINATES: set sign of q
  277.      EXPRO_q = abs(q(:))*ipccw*btccw
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 277 
  A loop starting at line 277 was not vectorized because it contains a call to a subroutine or function on line 277.

  278.      EXPRO_kappa = kappa(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 278 
  A loop starting at line 278 was not vectorized because it contains a call to a subroutine or function on line 278.

  279.      EXPRO_delta = delta(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 279 
  A loop starting at line 279 was not vectorized because it contains a call to a subroutine or function on line 279.

  280.      EXPRO_te = plst_ts(:,1)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 280 
  A loop starting at line 280 was not vectorized because it contains a call to a subroutine or function on line 280.

  281.      EXPRO_ne = plst_ns(:,1)*1e-19
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 281 
  A loop starting at line 281 was not vectorized because it contains a call to a subroutine or function on line 281.

  282.      EXPRO_z_eff = plst_zeff(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 282 
  A loop starting at line 282 was not vectorized because it contains a call to a subroutine or function on line 282.

  283.      EXPRO_w0 = omega0(:) 
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 283 
  A loop starting at line 283 was not vectorized because it contains a call to a subroutine or function on line 283.

  284.      EXPRO_flow_mom = flow_mom(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 284 
  A loop starting at line 284 was not vectorized because it contains a call to a subroutine or function on line 284.

  285.      EXPRO_pow_e = pow_e(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 285 
  A loop starting at line 285 was not vectorized because it contains a call to a subroutine or function on line 285.

  286.      EXPRO_pow_i = pow_i(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 286 
  A loop starting at line 286 was not vectorized because it contains a call to a subroutine or function on line 286.

  287.      EXPRO_pow_ei = pow_ei(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 287 
  A loop starting at line 287 was not vectorized because it contains a call to a subroutine or function on line 287.

  288.      EXPRO_zeta = zeta(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 288 
  A loop starting at line 288 was not vectorized because it contains a call to a subroutine or function on line 288.

  289.      EXPRO_flow_beam = flow_beam(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 289 
  A loop starting at line 289 was not vectorized because it contains a call to a subroutine or function on line 289.

  290.      EXPRO_flow_wall = 0.0
ftn-6204 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 290 
  A loop starting at line 290 was vectorized.

  291.      EXPRO_zmag = zmag(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 291 
  A loop starting at line 291 was not vectorized because it contains a call to a subroutine or function on line 291.

  292.      EXPRO_ptot = p_tot ! total pressure, thermal + fast ion
ftn-6209 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 292 
  A loop starting at line 292 was partially vectorized.

  293.      ! COORDINATES: This poloidal flux has correct sign (see above).
  294.      EXPRO_polflux = dpsi(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 294 
  A loop starting at line 294 was not vectorized because it contains a call to a subroutine or function on line 294.

  295.    
  296.      EXPRO_ni = 0.0
ftn-6209 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 296 
  A loop starting at line 296 was partially vectorized.

  297.      EXPRO_ti = 0.0
ftn-6209 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 297 
  A loop starting at line 297 was partially vectorized.

  298.    
  299.      ! ni,ti,vphi
  300.      do i=1,plst_dp1_nspec_all-1
  301.         ip = reorder_vec(i)
  302.         EXPRO_ni(i,:) = plst_ns(:,ip+1)*1e-19
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 302 
  A loop starting at line 302 was not vectorized because it contains a call to a subroutine or function on line 302.

  303.         EXPRO_ti(i,:) = plst_ts(:,ip+1)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 303 
  A loop starting at line 303 was not vectorized because it contains a call to a subroutine or function on line 303.

  304.         if (trim(plst_all_name(ip+1)) == 'C') then
  305.            ! COORDINATES: -ipccw accounts for plasmastate toroidal angle convention
  306.            EXPRO_vtor(i,:) = -ipccw*plst_omegat(:)*(rmaj(:)+rmin(:))
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 306 
  A loop starting at line 306 was not vectorized because it contains a call to a subroutine or function on line 306.

  307.         endif
  308.      enddo
  309.    
  310.      !---------------------------------------------------
  311.      ! Read the cer file and overlay
  312.      !
  313.      if (cer_file /= "null") then
  314.         rho = plst_rho
ftn-6209 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 314 
  A loop starting at line 314 was partially vectorized.

  315.         allocate(vpolc_exp(nx))
  316.         allocate(vtorc_exp(nx))
  317.         call prgen_read_cer
  318.         EXPRO_w0 = omega0(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 318 
  A loop starting at line 318 was not vectorized because it contains a call to a subroutine or function on line 318.

  319.         do i=1,plst_dp1_nspec_all
  320.            if (trim(plst_all_name(ip+1)) == 'C') then
  321.               EXPRO_vtor(i,:) = vtorc_exp(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 321 
  A loop starting at line 321 was not vectorized because it contains a call to a subroutine or function on line 321.

  322.               EXPRO_vpol(i,:) = vpolc_exp(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 322 
  A loop starting at line 322 was not vectorized because it contains a call to a subroutine or function on line 322.

  323.            endif
  324.         enddo
  325.      endif
  326.      !---------------------------------------------------
  327.    
  328.      ! Additional powers (fusion and radiation)
  329.      EXPRO_pow_e_fus = pow_e_fus(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 329 
  A loop starting at line 329 was not vectorized because it contains a call to a subroutine or function on line 329.

  330.      EXPRO_pow_i_fus  = pow_i_fus(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 330 
  A loop starting at line 330 was not vectorized because it contains a call to a subroutine or function on line 330.

  331.      EXPRO_pow_e_sync = pow_e_sync(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 331 
  A loop starting at line 331 was not vectorized because it contains a call to a subroutine or function on line 331.

  332.      EXPRO_pow_e_brem = pow_e_brem(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 332 
  A loop starting at line 332 was not vectorized because it contains a call to a subroutine or function on line 332.

  333.      EXPRO_pow_e_line = pow_e_line(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 333 
  A loop starting at line 333 was not vectorized because it contains a call to a subroutine or function on line 333.

  334.    
  335.      ! Additional powers (external heating)
  336.      EXPRO_pow_e_aux = pow_e_aux(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 336 
  A loop starting at line 336 was not vectorized because it contains a call to a subroutine or function on line 336.

  337.      EXPRO_pow_i_aux = pow_i_aux(:)
ftn-6262 ftn: VECTOR PRGEN_MAP_PLASMASTATE, File = prgen_map_plasmastate.f90, Line = 337 
  A loop starting at line 337 was not vectorized because it contains a call to a subroutine or function on line 337.

  338.      !---------------------------------------------------------
  339.    
  340.      ! Ion reordering diagnostics
  341.    
  342.      print '(a)','INFO: (prgen) Created these species:'
  343.      do i=1,n_ion_max
  344.         ip = reorder_vec(i)
  345.         if (ip >= plst_dp1_nspec_all) then
  346.            print '(t6,i2,1x,3(a))',i,'[null]'
  347.         else
  348.            if (ip+1 > plst_dp1_nspec_th) then
  349.               ion_type(i) = type_fast
  350.            else
  351.               ion_type(i) = type_therm
  352.            endif
  353.            print '(t6,i2,1x,a,1x,a)',i,trim(plst_all_name(ip+1)),ion_type(i)
  354.            ion_mass(i) = plst_m_all(ip+1)/1.66e-27
  355.            ion_z(i)    = nint(plst_q_all(ip+1)/1.6022e-19)
  356.            call prgen_ion_name(nint(ion_mass(i)),ion_z(i),ion_name(i))     
  357.         endif
  358.      enddo
  359.    
  360.    end subroutine prgen_map_plasmastate


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                         E x t e r n a l   R e p o r t
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Name  Messages
----  --------
ABS(Intrinsic)
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN_MAP_PLASMASTATE (Line 117, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 119, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 124, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 260, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 277, file prgen_map_plasmastate.f90)

Name  Messages
----  --------
BOUND_DERIV
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN_MAP_PLASMASTATE (Line 136, file prgen_map_plasmastate.f90)

Name  Messages
----  --------
EXPRO_ALLOC
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN_MAP_PLASMASTATE (Line 271, file prgen_map_plasmastate.f90)

Name  Messages
----  --------
EXPRO_INTERFACE
      Defined as:  No definitions.

      Used By:     PRGEN_MAP_PLASMASTATE

Name  Messages
----  --------
MIN(Intrinsic)
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN_MAP_PLASMASTATE (Line 256, file prgen_map_plasmastate.f90)

Name  Messages
----  --------
MINVAL(Intrinsic)
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN_MAP_PLASMASTATE (Line 96, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 99, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 102, file prgen_map_plasmastate.f90)

Name  Messages
----  --------
NINT(Intrinsic)
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN_MAP_PLASMASTATE (Line 196, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 234, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 355, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 356, file prgen_map_plasmastate.f90)

Name  Messages
----  --------
PRGEN_GLOBALS
      Defined as:  No definitions.

      Used By:     PRGEN_MAP_PLASMASTATE

Name  Messages
----  --------
PRGEN_ION_NAME
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN_MAP_PLASMASTATE (Line 356, file prgen_map_plasmastate.f90)

Name  Messages
----  --------
PRGEN_MAP_PLASMASTATE
      Defined as:  Subroutine (line 12, file prgen_map_plasmastate.f90)

      Interface:   None

      Calls:       MINVAL(Intrinsic) (Line 96, file prgen_map_plasmastate.f90)
                   MINVAL(Intrinsic) (Line 99, file prgen_map_plasmastate.f90)
                   MINVAL(Intrinsic) (Line 102, file prgen_map_plasmastate.f90)
                   ABS(Intrinsic) (Line 117, file prgen_map_plasmastate.f90)
                   ABS(Intrinsic) (Line 119, file prgen_map_plasmastate.f90)
                   ABS(Intrinsic) (Line 124, file prgen_map_plasmastate.f90)
                   ABS(Intrinsic) (Line 260, file prgen_map_plasmastate.f90)
                   ABS(Intrinsic) (Line 277, file prgen_map_plasmastate.f90)
                   BOUND_DERIV (Line 136, file prgen_map_plasmastate.f90)
                   TRIM(Intrinsic) (Line 163, file prgen_map_plasmastate.f90)
                   TRIM(Intrinsic) (Line 304, file prgen_map_plasmastate.f90)
                   TRIM(Intrinsic) (Line 320, file prgen_map_plasmastate.f90)
                   TRIM(Intrinsic) (Line 353, file prgen_map_plasmastate.f90)
                   SUM(Intrinsic) (Line 196, file prgen_map_plasmastate.f90)
                   SUM(Intrinsic) (Line 199, file prgen_map_plasmastate.f90)
                   SUM(Intrinsic) (Line 234, file prgen_map_plasmastate.f90)
                   SUM(Intrinsic) (Line 236, file prgen_map_plasmastate.f90)
                   SUM(Intrinsic) (Line 258, file prgen_map_plasmastate.f90)
                   SUM(Intrinsic) (Line 260, file prgen_map_plasmastate.f90)
                   NINT(Intrinsic) (Line 196, file prgen_map_plasmastate.f90)
                   NINT(Intrinsic) (Line 234, file prgen_map_plasmastate.f90)
                   NINT(Intrinsic) (Line 355, file prgen_map_plasmastate.f90)
                   NINT(Intrinsic) (Line 356, file prgen_map_plasmastate.f90)
                   MIN(Intrinsic) (Line 256, file prgen_map_plasmastate.f90)
                   EXPRO_ALLOC (Line 271, file prgen_map_plasmastate.f90)
                   PRGEN_ION_NAME (Line 356, file prgen_map_plasmastate.f90)

        Uses:      PRGEN_GLOBALS
                   EXPRO_INTERFACE

Name  Messages
----  --------
PRGEN_READ_CER
      Defined as:  No definitions.

                   No calls.  It is not called and does not use any procedure.

      Interface:   None

Name  Messages
----  --------
SUM(Intrinsic)
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN_MAP_PLASMASTATE (Line 196, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 199, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 234, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 236, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 258, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 260, file prgen_map_plasmastate.f90)

Name  Messages
----  --------
TRIM(Intrinsic)
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN_MAP_PLASMASTATE (Line 163, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 304, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 320, file prgen_map_plasmastate.f90)
                   PRGEN_MAP_PLASMASTATE (Line 353, file prgen_map_plasmastate.f90)

Name  Messages
----  --------
_F90_TRIM(Intrinsic)
      Defined as:  No definitions.

                   No calls.  It is not called and does not use any procedure.

      Interface:   None

Name  Messages
----  --------
__MINVAL(Intrinsic)
      Defined as:  No definitions.

                   No calls.  It is not called and does not use any procedure.

      Interface:   None

Name  Messages
----  --------
__SUM(Intrinsic)
      Defined as:  No definitions.

                   No calls.  It is not called and does not use any procedure.

      Interface:   None


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
