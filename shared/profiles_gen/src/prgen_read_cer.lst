%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                          S u m m a r y   R e p o r t
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Compilation
-----------
File     : /global/u2/b/bassem/gyro-EP/shared/profiles_gen/src/prgen_read_cer.f90
Compiled : 01/19/21  15:34:58
Compiler : Version 9.1.0
Ftnlx    : Version 9.1.0 
Target   : x86-64
Command  : ftn_driver.exe -hcpu=haswell -hdynamic -D__CRAYXC -D__CRAY_HASWELL
           -D__CRAYXT_COMPUTE_LINUX_TARGET -hnetwork=aries -hnoomp -em
           -J/global/homes/b/bassem/gyro-EP/modules -sreal64 -eD -Ktrap=fp -m1
           -Rbcdps -G0 -I/opt/cray/pe/netcdf/4.6.3.2/CRAYCLANG/9.0/include
           -c prgen_read_cer.f90
           -I/opt/cray/pe/cce/9.1.0/cce-clang/x86_64/lib/clang/9.0.0/include
           -I/opt/cray/pe/cce/9.1.0/cce/x86_64/include/craylibs -I/usr/include
           -I/usr/include -I/opt/cray/pe/fftw/3.3.8.4/haswell/include
           -I/opt/cray/pe/libsci/19.06.1/CRAY/9.0/x86_64/include
           -I/opt/cray/pe/mpt/7.7.10/gni/mpich-cray/9.0/include
           -I/opt/cray/pe/hdf5/1.10.5.2/cray/9.0/include
           -I/opt/cray/pe/netcdf/4.6.3.2/cray/9.0/include
           -I/opt/cray/rca/2.2.20-7.0.1.1_4.53__g8e3fb5b.ari/include
           -I/opt/cray/alps/6.6.58-7.0.1.1_6.10__g437d88db.ari/include
           -I/opt/cray/xpmem/2.2.20-7.0.1.1_4.14__g0475745.ari/include
           -I/opt/cray/gni-headers/5.0.12.0-7.0.1.1_6.32__g3b1768f.ari/include
           -I/opt/cray/dmapp/7.1.1-7.0.1.1_4.54__g38cf134.ari/include
           -I/opt/cray/pe/pmi/5.0.14/include
           -I/opt/cray/ugni/6.0.14.0-7.0.1.1_7.40__ge78e5b0.ari/include
           -I/opt/cray/udreg/2.3.2-7.0.1.1_3.38__g8175d3d.ari/include
           -I/opt/cray/wlm_detect/1.3.3-7.0.1.1_4.16__g7109084.ari/include
           -I/opt/cray/krca/2.2.6-7.0.1.1_5.39__gb641b12.ari/include
           -I/opt/cray-hss-devel/9.0.0/include
Program
  Units  : PRGEN_READ_CER

ftnlx report
------------
Source   : /global/u2/b/bassem/gyro-EP/shared/profiles_gen/src/prgen_read_cer.f90
Date     : 01/19/2021  15:34:58


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                          S o u r c e   L i s t i n g
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    1.    !--------------------------------------------------------
    2.    ! Read optional CER file
    3.    !
    4.    ! col 1: rho (root of normalized toroidal flux)
    5.    ! col 2: Ti (keV)
    6.    ! col 3: nc (10^19/m^3) 
    7.    ! col 4: vpolc (km/s)
    8.    ! col 5: vtorc (km/s)
    9.    ! col 6: Er (kV/m)
   10.    ! col 7: omega0 (krad/s) [(c*Er)/(R*Bp)]
   11.    !
   12.    ! NOTE also that the CER toroidal angle sign convention 
   13.    ! is fixed and opposite the GACODE convention.  The CER 
   14.    ! angle is phi in the (R,phi,Z) system defined here 
   15.    !
   16.    ! https://fusion.gat.com/theory/Gyrofieldorient 
   17.    !--------------------------------------------------------
   18.    
   19.    subroutine prgen_read_cer
   20.    
   21.      use prgen_globals
   22.    
   23.      implicit none
   24.    
   25.      ! number of columns in CER file
   26.      integer, parameter :: n_col = 7
   27.    
   28.      character (len=1) :: a
   29.      integer :: n_in
   30.      integer :: i
   31.      integer :: ierr
   32.      integer :: count
   33.      real :: xa,xb
   34.      real :: fa(3),fb(3)
   35.      real, dimension(n_col) :: x
   36.      real, dimension(:), allocatable :: rho_in
   37.      real, dimension(:,:), allocatable :: f_in
   38.    
   39.      !-------------------------------------------------------
   40.      ! Determine vector length
   41.      !
   42.      count = 0 
   43.      open(unit=1,file=cer_file,status='old')
   44.      read(1,*) a
   45.      do 
   46.         read(1,*,iostat=ierr) x(1)
   47.         if (ierr < 0) exit
   48.         count = count+1
   49.      enddo
   50.      close(1)
   51.      !
   52.      n_in = count
   53.      !-------------------------------------------------------
   54.    
   55.      !-------------------------------------------------------
   56.      ! Read data
   57.      !
   58.      allocate(rho_in(n_in))
   59.      allocate(f_in(n_in,3))
   60.      !
   61.      open(unit=1,file=cer_file,status='old')
   62.      read(1,*) a
   63.      do i=1,n_in 
   64.         read(1,*,iostat=ierr) x(:)
   65.         if (ierr < 0) then
   66.            print '(t2,a,a)','ERROR: CER format error.'
   67.            stop
   68.         endif
   69.         rho_in(i) = x(1)
   70.         f_in(i,1) = x(4) ! vpol (km/s)
   71.         f_in(i,2) = x(5) ! vtor (km/s)
   72.         f_in(i,3) = x(7) ! omega0 (krad/s)
   73.      enddo
   74.      print '(a,a)','INFO: Assuming 7-column Solomon CER format in ',trim(cer_file)
   75.    
   76.      close(1)
   77.      !-------------------------------------------------------
   78.    
   79.      !-------------------------------------------------------
   80.      ! Map last gridpoint so that rho_in(n_er) = 1.
   81.      !
   82.      xa = rho_in(n_in-1)
   83.      xb = rho_in(n_in)
   84.      fa(:) = f_in(n_in-1,:)
ftn-6262 ftn: VECTOR PRGEN_READ_CER, File = prgen_read_cer.f90, Line = 84 
  A loop starting at line 84 was not vectorized because it contains a call to a subroutine or function on line 84.

   85.      fb(:) = f_in(n_in,:)
ftn-6262 ftn: VECTOR PRGEN_READ_CER, File = prgen_read_cer.f90, Line = 85 
  A loop starting at line 85 was not vectorized because it contains a call to a subroutine or function on line 85.

   86.      !
   87.      rho_in(n_in) = 1.0
   88.      f_in(n_in,:) = fa(:)*(xb-1.0)/(xb-xa)+fb(:)*(1.0-xa)/(xb-xa)
ftn-6262 ftn: VECTOR PRGEN_READ_CER, File = prgen_read_cer.f90, Line = 88 
  A loop starting at line 88 was not vectorized because it contains a call to a subroutine or function on line 88.

   89.      !-------------------------------------------------------
   90.    
   91.      !-------------------------------------------------------
   92.      ! Spline interpolation from CER grid to ITERDB rho grid.
   93.      !
   94.      ! COORDINATES: convert vpolc to m/s (- sign for CER phi to GACODE varphi)
   95.      call cub_spline(rho_in,-f_in(:,1)*1e3,n_in,rho,vpolc_exp,nx)
                                   ^                                     
ftn-1438 ftn: CAUTION PRGEN_READ_CER, File = prgen_read_cer.f90, Line = 95, Column = 26 
  This argument produces a copy in to a temporary variable.

   96.      !
   97.      ! COORDINATES: convert vtorc to m/s (- sign for CER phi to GACODE varphi)
   98.      call cub_spline(rho_in,-f_in(:,2)*1e3,n_in,rho,vtorc_exp,nx)
                                   ^                                     
ftn-1438 ftn: CAUTION PRGEN_READ_CER, File = prgen_read_cer.f90, Line = 98, Column = 26 
  This argument produces a copy in to a temporary variable.

   99.      !
  100.      ! COORDINATES: convert omega to (1/s) (- sign for CER phi to GACODE varphi)
  101.      call cub_spline(rho_in,-f_in(:,3)*1e3,n_in,rho,omega0,nx)
                                   ^                                  
ftn-1438 ftn: CAUTION PRGEN_READ_CER, File = prgen_read_cer.f90, Line = 101, Column = 26 
  This argument produces a copy in to a temporary variable.

  102.      !-------------------------------------------------------
  103.    
  104.    end subroutine prgen_read_cer


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                         E x t e r n a l   R e p o r t
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Name  Messages
----  --------
CUB_SPLINE
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN_READ_CER (Line 95, file prgen_read_cer.f90)
                   PRGEN_READ_CER (Line 98, file prgen_read_cer.f90)
                   PRGEN_READ_CER (Line 101, file prgen_read_cer.f90)

Name  Messages
----  --------
PRGEN_GLOBALS
      Defined as:  No definitions.

      Used By:     PRGEN_READ_CER

Name  Messages
----  --------
PRGEN_READ_CER
      Defined as:  Subroutine (line 19, file prgen_read_cer.f90)

      Interface:   None

      Calls:       TRIM(Intrinsic) (Line 74, file prgen_read_cer.f90)
                   CUB_SPLINE (Line 95, file prgen_read_cer.f90)
                   CUB_SPLINE (Line 98, file prgen_read_cer.f90)
                   CUB_SPLINE (Line 101, file prgen_read_cer.f90)

        Uses:      PRGEN_GLOBALS

Name  Messages
----  --------
TRIM(Intrinsic)
      Defined as:  No definitions.

      Interface:   None

      Called By:   PRGEN_READ_CER (Line 74, file prgen_read_cer.f90)

Name  Messages
----  --------
_F90_TRIM(Intrinsic)
      Defined as:  No definitions.

                   No calls.  It is not called and does not use any procedure.

      Interface:   None


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
