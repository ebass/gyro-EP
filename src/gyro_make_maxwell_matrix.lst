%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                          S u m m a r y   R e p o r t
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Compilation
-----------
File     : /global/u2/b/bassem/gyro-EP/src/gyro_make_maxwell_matrix.f90
Compiled : 01/19/21  15:35:41
Compiler : Version 9.1.0
Ftnlx    : Version 9.1.0 
Target   : x86-64
Command  : ftn_driver.exe -hcpu=haswell -hdynamic -D__CRAYXC -D__CRAY_HASWELL
           -D__CRAYXT_COMPUTE_LINUX_TARGET -hnetwork=aries -hnoomp -em
           -J/global/homes/b/bassem/gyro-EP/modules -sreal64 -eD -Ktrap=fp -m1
           -Rbcdps -G0 -I/opt/cray/pe/fftw/3.3.8.4/haswell/include
           -c gyro_make_maxwell_matrix.f90
           -I/opt/cray/pe/cce/9.1.0/cce-clang/x86_64/lib/clang/9.0.0/include
           -I/opt/cray/pe/cce/9.1.0/cce/x86_64/include/craylibs -I/usr/include
           -I/usr/include -I/opt/cray/pe/fftw/3.3.8.4/haswell/include
           -I/opt/cray/pe/libsci/19.06.1/CRAY/9.0/x86_64/include
           -I/opt/cray/pe/mpt/7.7.10/gni/mpich-cray/9.0/include
           -I/opt/cray/pe/hdf5/1.10.5.2/cray/9.0/include
           -I/opt/cray/pe/netcdf/4.6.3.2/cray/9.0/include
           -I/opt/cray/rca/2.2.20-7.0.1.1_4.53__g8e3fb5b.ari/include
           -I/opt/cray/alps/6.6.58-7.0.1.1_6.10__g437d88db.ari/include
           -I/opt/cray/xpmem/2.2.20-7.0.1.1_4.14__g0475745.ari/include
           -I/opt/cray/gni-headers/5.0.12.0-7.0.1.1_6.32__g3b1768f.ari/include
           -I/opt/cray/dmapp/7.1.1-7.0.1.1_4.54__g38cf134.ari/include
           -I/opt/cray/pe/pmi/5.0.14/include
           -I/opt/cray/ugni/6.0.14.0-7.0.1.1_7.40__ge78e5b0.ari/include
           -I/opt/cray/udreg/2.3.2-7.0.1.1_3.38__g8175d3d.ari/include
           -I/opt/cray/wlm_detect/1.3.3-7.0.1.1_4.16__g7109084.ari/include
           -I/opt/cray/krca/2.2.6-7.0.1.1_5.39__gb641b12.ari/include
           -I/opt/cray-hss-devel/9.0.0/include
Program
  Units  : GYRO_MAKE_MAXWELL_MATRIX

ftnlx report
------------
Source   : /global/u2/b/bassem/gyro-EP/src/gyro_make_maxwell_matrix.f90
Date     : 01/19/2021  15:35:41


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                          S o u r c e   L i s t i n g
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    1.    !-----------------------------------------------------
    2.    ! gyro_make_maxwell_matrix.f90
    3.    !
    4.    ! PURPOSE:
    5.    !  Define sparse form of Poisson-Ampere (Maxwell) 
    6.    !  matrix and factorize using UMFPACK.
    7.    !-----------------------------------------------------
    8.    
    9.    subroutine gyro_make_maxwell_matrix
   10.    
   11.      use gyro_globals
   12.      use gyro_maxwell_private
   13.    
   14.      !------------------------
   15.      implicit none
   16.      !------------------------
   17.    
   18.      !----------------------------------------------------------------
   19.      ! Begin by doing a hand-count of the nonzero elements in 
   20.      ! the sparse Maxwell matrix:
   21.      !
   22.      if (n_field == 1) then
   23.    
   24.         ! ELECTROSTATIC
   25.    
   26.         ! Row dimension of sparse Poisson matrix
   27.         n_maxwell_row = n_x*n_blend
   28.    
   29.         ! radial band width
   30.         n_gyro = 2*m_gyro-i_gyro+1
   31.    
   32.         if (boundary_method == 1) then
   33.    
   34.            ! nonzero elements in n=0 Poisson matrix:
   35.            n_zero = (n_x-1)*n_gyro*n_blend**2+n_x*n_blend
   36.    
   37.            ! nonzero elements in n>0 Poisson matrix:
   38.            n_fini = n_x*n_gyro*n_blend**2
   39.    
   40.         else
   41.    
   42.            ! nonzero elements in n=0 nonperiodic Poisson matrices:
   43.            n_zero = (n_x*n_gyro-m_gyro*(m_gyro+1))*n_blend**2
   44.    
   45.            ! same number of nonzeros in n>0 nonperiodic matrices:
   46.            n_fini = n_zero
   47.    
   48.         endif
   49.    
   50.      else if (n_field == 2) then
   51.    
   52.         ! ELECTROMAGNETIC -- A_parallel only
   53.    
   54.         ! Row dimension of sparse Maxwell submatrix
   55.         n_maxwell_row = 2*n_x*n_blend
   56.    
   57.         n_dx = 2*mg_dx-ig_dx+1
   58.    
   59.         ! radial band width
   60.         n_gyro = 2*m_gyro-i_gyro+1
   61.    
   62.         if (boundary_method == 1) then
   63.    
   64.            ! nonzero elements in n=0 Ampere matrix:
   65.            n_zero = (n_x-1)*n_gyro*n_blend**2+n_x*n_blend & 
   66.                 + (n_x-1)*n_dx*n_blend**2+n_x*n_blend & 
   67.                 + 2*(n_x-1)*n_blend**2
   68.    
   69.            ! nonzero elements in n>0 Ampere matrix:
   70.            n_fini = n_x*n_gyro*n_blend**2 + &
   71.                 n_x*n_dx*n_blend**2 + & 
   72.                 2*n_x*n_blend**2
   73.    
   74.         else
   75.    
   76.            ! nonzero elements in nonperiodic Ampere matrices:
   77.            n_zero = (n_x*n_dx-mg_dx*(mg_dx+1))*n_blend**2 &   ! MAA
   78.                 + (n_x*n_gyro-m_gyro*(m_gyro+1))*n_blend**2 & ! MPP
   79.                 + 2*n_x*n_blend**2                            ! IPA,IAP
   80.    
   81.            ! same number of nonzeros in n>0 nonperiodic matrices:
   82.            n_fini = n_zero
   83.    
   84.         endif
   85.    
   86.      else
   87.    
   88.         ! ELECTROMAGNETIC -- A_parallel and B_parallel
   89.    
   90.         ! Row dimension of sparse Maxwell submatrix
   91.         n_maxwell_row = 3*n_x*n_blend
   92.    
   93.         n_dx = 2*mg_dx-ig_dx+1
   94.    
   95.         ! radial band width
   96.         n_gyro = 2*m_gyro-i_gyro+1
   97.    
   98.         if (boundary_method == 1) then
   99.    
  100.            ! nonzero elements in n=0 Ampere matrix:
  101.            n_zero = (n_x-1)*n_gyro*n_blend**2+n_x*n_blend & 
  102.                 + (n_x-1)*n_dx*n_blend**2+n_x*n_blend &
  103.                 + (n_x-1)*n_gyro*n_blend**2+n_x*n_blend &
  104.                 + 2*(n_x-1)*n_gyro*n_blend**2 &
  105.                 + 4*(n_x-1)*n_blend**2 
  106.    
  107.            ! nonzero elements in n>0 Ampere matrix:
  108.            n_fini = 4*n_x*n_gyro*n_blend**2 + &
  109.                 n_x*n_dx*n_blend**2 + & 
  110.                 4*n_x*n_blend**2
  111.    
  112.         else
  113.    
  114.            ! nonzero elements in nonperiodic Ampere matrices:
  115.            n_zero = (n_x*n_dx-mg_dx*(mg_dx+1))*n_blend**2 &     ! MAA
  116.                 + 4*(n_x*n_gyro-m_gyro*(m_gyro+1))*n_blend**2 & ! MPP,MPB,MBP,MBB
  117.                 + 4*n_x*n_blend**2                              ! IPA,IAP,IAB,IBA
  118.    
  119.            n_fini = n_zero
  120.    
  121.         endif
  122.    
  123.      endif
  124.      !----------------------------------------------------------------
  125.    
  126.      if (n_1(in_1) == 0) then
  127.         n_maxwell = n_zero
  128.      else
  129.         n_maxwell = n_fini
  130.      endif
  131.    
  132.      lindx(3)  = 2*n_maxwell
  133.      lvalue(3) = n_maxwell
  134.    
  135.      allocate(m_maxwell(lvalue(3)))
  136.      allocate(indx_maxwell(lindx(3)))
  137.    
  138.      if (n_1(in_1) == 0 .and. boundary_method == 1) then
  139.         n_x_max  = n_x-1
  140.      else
  141.         n_x_max  = n_x
  142.      endif
  143.    
  144.      allocate(ap_mm(n_x,-m_gyro:m_gyro-i_gyro,n_blend,n_blend))
  145.      call gyro_blend_poisson(1)
  146.    
  147.      if (n_field > 1) then
  148.         allocate(aa_mm(n_x,-mg_dx:mg_dx-ig_dx,n_blend,n_blend))
  149.         call gyro_blend_ampere
  150.      endif
  151.    
  152.      if (n_field == 3) then
  153.         allocate(ab_mm(n_x,-m_gyro:m_gyro-i_gyro,n_blend,n_blend))
  154.         allocate(abp_mm(n_x,-m_gyro:m_gyro-i_gyro,n_blend,n_blend))
  155.         call gyro_blend_ampereperp
  156.      endif
  157.    
  158.      if (sparse_method == 1) then
  159.         call gyro_sparse_solve_umfpack(n_maxwell,n_maxwell_row,3,0)
  160.      else
  161.         call gyro_sparse_solve_mumps(n_maxwell,n_maxwell_row,3,0)
  162.      endif
  163.    
  164.      !---------------------------------------------
  165.      ! These are large matrices and deallocation is
  166.      ! important:
  167.      !
  168.      deallocate(ap_mm)
  169.      if (n_field > 1) deallocate(aa_mm)
  170.      if (n_field == 3) then
  171.         deallocate(ab_mm); deallocate(abp_mm)
  172.      endif
  173.      !---------------------------------------------
  174.    
  175.      if (debug_flag == 1 .and. i_proc == 0) then
  176.         print *,'[gyro_make_maxwell_matrix done]'
  177.      endif
  178.    
  179.    end subroutine gyro_make_maxwell_matrix


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                         E x t e r n a l   R e p o r t
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Name  Messages
----  --------
CHAR(Intrinsic)
      Defined as:  No definitions.

                   No calls.  It is not called and does not use any procedure.

      Interface:   None

Name  Messages
----  --------
GYRO_BLEND_AMPERE
      Defined as:  No definitions.

                   No calls.  It is not called and does not use any procedure.

      Interface:   None

Name  Messages
----  --------
GYRO_BLEND_AMPEREPERP
      Defined as:  No definitions.

                   No calls.  It is not called and does not use any procedure.

      Interface:   None

Name  Messages
----  --------
GYRO_BLEND_POISSON
      Defined as:  No definitions.

                   No calls.  It is not called and does not use any procedure.

      Interface:   None

Name  Messages
----  --------
GYRO_GLOBALS
      Defined as:  No definitions.

      Used By:     GYRO_MAKE_MAXWELL_MATRIX

Name  Messages
----  --------
GYRO_MAKE_MAXWELL_MATRIX
      Defined as:  Subroutine (line 9, file gyro_make_maxwell_matrix.f90)

      Interface:   None

      Calls:       GYRO_SPARSE_SOLVE_UMFPACK (Line 159, file gyro_make_maxwell_matrix.f90)
                   GYRO_SPARSE_SOLVE_MUMPS (Line 161, file gyro_make_maxwell_matrix.f90)

        Uses:      GYRO_GLOBALS
                   GYRO_MAXWELL_PRIVATE

Name  Messages
----  --------
GYRO_MAXWELL_PRIVATE
      Defined as:  No definitions.

      Used By:     GYRO_MAKE_MAXWELL_MATRIX

Name  Messages
----  --------
GYRO_SPARSE_SOLVE_MUMPS
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_MAKE_MAXWELL_MATRIX (Line 161, file gyro_make_maxwell_matrix.f90)

Name  Messages
----  --------
GYRO_SPARSE_SOLVE_UMFPACK
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_MAKE_MAXWELL_MATRIX (Line 159, file gyro_make_maxwell_matrix.f90)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
