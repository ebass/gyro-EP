%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                          S u m m a r y   R e p o r t
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Compilation
-----------
File     : /global/u2/b/bassem/gyro-EP/src/gyro_tau_derivative.f90
Compiled : 01/19/21  15:35:52
Compiler : Version 9.1.0
Ftnlx    : Version 9.1.0 
Target   : x86-64
Command  : ftn_driver.exe -hcpu=haswell -hdynamic -D__CRAYXC -D__CRAY_HASWELL
           -D__CRAYXT_COMPUTE_LINUX_TARGET -hnetwork=aries -hnoomp -em
           -J/global/homes/b/bassem/gyro-EP/modules -sreal64 -eD -Ktrap=fp -m1
           -Rbcdps -G0 -I/opt/cray/pe/fftw/3.3.8.4/haswell/include
           -c gyro_tau_derivative.f90
           -I/opt/cray/pe/cce/9.1.0/cce-clang/x86_64/lib/clang/9.0.0/include
           -I/opt/cray/pe/cce/9.1.0/cce/x86_64/include/craylibs -I/usr/include
           -I/usr/include -I/opt/cray/pe/fftw/3.3.8.4/haswell/include
           -I/opt/cray/pe/libsci/19.06.1/CRAY/9.0/x86_64/include
           -I/opt/cray/pe/mpt/7.7.10/gni/mpich-cray/9.0/include
           -I/opt/cray/pe/hdf5/1.10.5.2/cray/9.0/include
           -I/opt/cray/pe/netcdf/4.6.3.2/cray/9.0/include
           -I/opt/cray/rca/2.2.20-7.0.1.1_4.53__g8e3fb5b.ari/include
           -I/opt/cray/alps/6.6.58-7.0.1.1_6.10__g437d88db.ari/include
           -I/opt/cray/xpmem/2.2.20-7.0.1.1_4.14__g0475745.ari/include
           -I/opt/cray/gni-headers/5.0.12.0-7.0.1.1_6.32__g3b1768f.ari/include
           -I/opt/cray/dmapp/7.1.1-7.0.1.1_4.54__g38cf134.ari/include
           -I/opt/cray/pe/pmi/5.0.14/include
           -I/opt/cray/ugni/6.0.14.0-7.0.1.1_7.40__ge78e5b0.ari/include
           -I/opt/cray/udreg/2.3.2-7.0.1.1_3.38__g8175d3d.ari/include
           -I/opt/cray/wlm_detect/1.3.3-7.0.1.1_4.16__g7109084.ari/include
           -I/opt/cray/krca/2.2.6-7.0.1.1_5.39__gb641b12.ari/include
           -I/opt/cray-hss-devel/9.0.0/include
Program
  Units  : GYRO_TAU_DERIVATIVE

ftnlx report
------------
Source   : /global/u2/b/bassem/gyro-EP/src/gyro_tau_derivative.f90
Date     : 01/19/2021  15:35:52


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                          S o u r c e   L i s t i n g
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    1.    !------------------------------------------------
    2.    ! gyro_tau_derivative.f90 [caller gyro_rhs_total]
    3.    !
    4.    ! PURPOSE:
    5.    !  Compute the tau-derivative terms in the RHS 
    6.    !  (i.e., derivatives in the theta directions)
    7.    !  using 5-point rules.
    8.    !
    9.    ! NOTES:
   10.    !  Upwind dissipation is necessary for Landau
   11.    !  damping of zonal flows.  No dissipation will
   12.    !  result in "bouncing" instead of damping.
   13.    !------------------------------------------------
   14.    
   15.    subroutine gyro_tau_derivative
   16.    
   17.      use gyro_globals
   18.      use gyro_pointers
   19.      use ompdata
   20.    
   21.      !---------------------------------------
   22.      implicit none
   23.      !
   24.      integer :: p
   25.      !
   26.      integer :: mff,mf
   27.      integer :: mc
   28.      integer :: mb,mbb
   29.      !
   30.      real, dimension(n_x) :: v0
   31.      real :: upwind
   32.      !
   33.      complex :: pff,pf
   34.      complex :: pc
   35.      complex :: pb,pbb
   36.      !
   37.      complex, dimension(n_x,n_stack) :: fh0
   38.      complex, dimension(n_x,n_stack) :: fh
   39.      !
   40.      complex :: temp1
   41.      complex :: temp2
   42.      !---------------------------------------
   43.    
   44.      ! We should be calling this for gyrokinetic species only
   45.    
   46.    !$omp parallel private(upwind,p_nek_loc,ie,k,ck,p,mff,mf,mc,mb,mbb,pff,pf,pc,pb,pbb,temp1,temp2) &
   47.    !$omp private(is,p_nek,i,m)
   48.      do is=1,n_gk
   49.    
   50.         ! q has sign ipccw*btccw, but upwind dissipation must have 
   51.         ! fixed sign independent of q:
   52.         upwind = orbit_upwind_vec(is)*abs(q_norm)/q_norm
   53.    
   54.         p_nek_loc = 0
   55.         do p_nek=1+i_proc_1,n_nek_1,n_proc_1
   56.    
   57.            p_nek_loc = p_nek_loc+1
   58.    
   59.            ie = nek_e(p_nek)  
   60.            k  = nek_k(p_nek)   
   61.    
   62.            ck = class(k)
   63.    
   64.            do i = ibeg, iend
   65.    
   66.               fh0(i,:) = h(:,i,p_nek_loc,is) 
ftn-6262 ftn: VECTOR GYRO_TAU_DERIVATIVE, File = gyro_tau_derivative.f90, Line = 66 
  A loop starting at line 66 was not vectorized because it contains a call to a subroutine or function on line 66.

   67.               fh(i,:)  = fh0(i,:)+ &
ftn-6262 ftn: VECTOR GYRO_TAU_DERIVATIVE, File = gyro_tau_derivative.f90, Line = 67 
  A loop starting at line 67 was not vectorized because it contains a call to a subroutine or function on line 67.

   68.                    z(is)*alpha_s(is,i)*gyro_u(:,i,p_nek_loc,is)
   69.    
   70.               v0(i) = mu(is)*sqrt(tem_s(is,i))*v_theta(i,ie,k,is)/d_tau(ck)
   71.    
   72.               RHS_dt(:,i,p_nek_loc,is) = 0.0
ftn-6263 ftn: VECTOR GYRO_TAU_DERIVATIVE, File = gyro_tau_derivative.f90, Line = 72 
  A loop starting at line 72 was not vectorized because it contains a reference to a non-vector intrinsic on line 72.

   73.    
   74.               do m=1,n_stack
   75.    
   76.                  p = p_phys(ck,m)
   77.    
   78.                  mff = m_cyc(ck,m+2,p)
   79.                  mf  = m_cyc(ck,m+1,p)
   80.                  mc  = m_cyc(ck,m,p)
   81.                  mb  = m_cyc(ck,m-1,p)
   82.                  mbb = m_cyc(ck,m-2,p)
   83.    
   84.                  pff = p_cyc(ck,i,m+2,p)
   85.                  pf  = p_cyc(ck,i,m+1,p)
   86.                  pc  = p_cyc(ck,i,m,p)
   87.                  pb  = p_cyc(ck,i,m-1,p)
   88.                  pbb = p_cyc(ck,i,m-2,p)
   89.    
   90.                  temp1 = (-1.0/12.0)*pff*fh(i,mff) &
   91.                       +(8.0/12.0)*pf*fh(i,mf) &
   92.                       +(-8.0/12.0)*pb*fh(i,mb) &
   93.                       +(1.0/12.0)*pbb*fh(i,mbb) 
   94.    
   95.                  temp2 = (1.0/12.0)*pff*fh0(i,mff) &
   96.                       +(-4.0/12.0)*pf*fh0(i,mf) &
   97.                       +(6.0/12.0)*pc*fh0(i,mc) &
   98.                       +(-4.0/12.0)*pb*fh0(i,mb) &
   99.                       +(1.0/12.0)*pbb*fh0(i,mbb) 
  100.    
  101.    
  102.                  !------------------------------------------------
  103.                  ! Entropy tracking:
  104.                  !
  105.                  RHS_dt(m,i,p_nek_loc,is) =  RHS_dt(m,i,p_nek_loc,is) &
  106.                       +real(v0(i)*(-upwind*temp2)*conjg(fh(i,m)))
  107.                  !------------------------------------------------
  108.    
  109.                  RHS(m,i,p_nek_loc,is) = RHS(m,i,p_nek_loc,is)+ &
  110.                       v0(i)*(sigma_tau(ck,p)*temp1-upwind*temp2)
  111.    
  112.               enddo ! m
  113.    
  114.            enddo ! i
  115.    
  116.         enddo ! p_nek
  117.    
  118.      enddo ! is
  119.    !$omp end parallel
  120.    
  121.    end subroutine gyro_tau_derivative


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                         E x t e r n a l   R e p o r t
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Name  Messages
----  --------
ABS(Intrinsic)
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_TAU_DERIVATIVE (Line 52, file gyro_tau_derivative.f90)

Name  Messages
----  --------
CHAR(Intrinsic)
      Defined as:  No definitions.

                   No calls.  It is not called and does not use any procedure.

      Interface:   None

Name  Messages
----  --------
CONJG(Intrinsic)
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_TAU_DERIVATIVE (Line 106, file gyro_tau_derivative.f90)

Name  Messages
----  --------
GYRO_GLOBALS
      Defined as:  No definitions.

      Used By:     GYRO_TAU_DERIVATIVE

Name  Messages
----  --------
GYRO_POINTERS
      Defined as:  No definitions.

      Used By:     GYRO_TAU_DERIVATIVE

Name  Messages
----  --------
GYRO_TAU_DERIVATIVE
      Defined as:  Subroutine (line 15, file gyro_tau_derivative.f90)

      Interface:   None

      Calls:       ABS(Intrinsic) (Line 52, file gyro_tau_derivative.f90)
                   SQRT(Intrinsic) (Line 70, file gyro_tau_derivative.f90)
                   CONJG(Intrinsic) (Line 106, file gyro_tau_derivative.f90)
                   REAL(Intrinsic) (Line 106, file gyro_tau_derivative.f90)

        Uses:      GYRO_GLOBALS
                   GYRO_POINTERS
                   OMPDATA

Name  Messages
----  --------
OMPDATA
      Defined as:  No definitions.

      Used By:     GYRO_TAU_DERIVATIVE

Name  Messages
----  --------
REAL(Intrinsic)
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_TAU_DERIVATIVE (Line 106, file gyro_tau_derivative.f90)

Name  Messages
----  --------
SQRT(Intrinsic)
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_TAU_DERIVATIVE (Line 70, file gyro_tau_derivative.f90)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
