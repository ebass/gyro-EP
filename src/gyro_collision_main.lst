%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                          S u m m a r y   R e p o r t
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Compilation
-----------
File     : /global/u2/b/bassem/gyro-EP/src/gyro_collision_main.f90
Compiled : 01/19/21  15:35:33
Compiler : Version 9.1.0
Ftnlx    : Version 9.1.0 
Target   : x86-64
Command  : ftn_driver.exe -hcpu=haswell -hdynamic -D__CRAYXC -D__CRAY_HASWELL
           -D__CRAYXT_COMPUTE_LINUX_TARGET -hnetwork=aries -hnoomp -em
           -J/global/homes/b/bassem/gyro-EP/modules -sreal64 -eD -Ktrap=fp -m1
           -Rbcdps -G0 -I/opt/cray/pe/fftw/3.3.8.4/haswell/include
           -c gyro_collision_main.f90
           -I/opt/cray/pe/cce/9.1.0/cce-clang/x86_64/lib/clang/9.0.0/include
           -I/opt/cray/pe/cce/9.1.0/cce/x86_64/include/craylibs -I/usr/include
           -I/usr/include -I/opt/cray/pe/fftw/3.3.8.4/haswell/include
           -I/opt/cray/pe/libsci/19.06.1/CRAY/9.0/x86_64/include
           -I/opt/cray/pe/mpt/7.7.10/gni/mpich-cray/9.0/include
           -I/opt/cray/pe/hdf5/1.10.5.2/cray/9.0/include
           -I/opt/cray/pe/netcdf/4.6.3.2/cray/9.0/include
           -I/opt/cray/rca/2.2.20-7.0.1.1_4.53__g8e3fb5b.ari/include
           -I/opt/cray/alps/6.6.58-7.0.1.1_6.10__g437d88db.ari/include
           -I/opt/cray/xpmem/2.2.20-7.0.1.1_4.14__g0475745.ari/include
           -I/opt/cray/gni-headers/5.0.12.0-7.0.1.1_6.32__g3b1768f.ari/include
           -I/opt/cray/dmapp/7.1.1-7.0.1.1_4.54__g38cf134.ari/include
           -I/opt/cray/pe/pmi/5.0.14/include
           -I/opt/cray/ugni/6.0.14.0-7.0.1.1_7.40__ge78e5b0.ari/include
           -I/opt/cray/udreg/2.3.2-7.0.1.1_3.38__g8175d3d.ari/include
           -I/opt/cray/wlm_detect/1.3.3-7.0.1.1_4.16__g7109084.ari/include
           -I/opt/cray/krca/2.2.6-7.0.1.1_5.39__gb641b12.ari/include
           -I/opt/cray-hss-devel/9.0.0/include
Program
  Units  : GYRO_COLLISION_MAIN

ftnlx report
------------
Source   : /global/u2/b/bassem/gyro-EP/src/gyro_collision_main.f90
Date     : 01/19/2021  15:35:34


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                          S o u r c e   L i s t i n g
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    1.    !---------------------------------------------------------------
    2.    ! gyro_collision_main.f90 
    3.    !
    4.    ! PURPOSE:
    5.    !  Collision step for Lorentz collisions.
    6.    !---------------------------------------------------------------
    7.    
    8.    subroutine gyro_collision_main
    9.    
   10.      use gyro_globals
   11.      use gyro_pointers
   12.      use ompdata
   13.    
   14.      !----------------------------------------
   15.      implicit none
   16.      !
   17.      integer :: ic
   18.      integer :: n_i
   19.      integer :: n_j
   20.      integer :: n_k
   21.      integer :: n_d
   22.      integer, external :: parallel_dim
   23.      !----------------------------------------
   24.    
   25.      !---------------------
   26.      ! BEGIN Collision step
   27.      !---------------------
   28.    
   29.      do ic=1,n_coll
   30.    
   31.         call gyro_timer_in('Coll.-step')
   32.    
   33.         is = c_map(ic)
   34.    
   35.         ! H_a = h_a + Psi_a
   36.         !
   37.         ! d(H_a)/dt = C(H_a) + d(Psi_a)/dt
   38.         !
   39.         ! We will ignore d(Psi_a)/dt
   40.    
   41.    !$omp parallel private(p_nek_loc,ie,k,p_nek,m,i)
   42.         p_nek_loc = 0
   43.         do p_nek=1+i_proc_1,n_nek_1,n_proc_1
   44.    
   45.            p_nek_loc = p_nek_loc+1
   46.    
   47.            ie = nek_e(p_nek)  
   48.            k  = nek_k(p_nek)   
   49.    
   50.            do m=1,n_stack
   51.               do i=ibeg,iend
   52.    
   53.                  f_coll(m,i,p_nek_loc) = h(m,i,p_nek_loc,is)+&
   54.                       z(is)*alpha_s(is,i)*gyro_u(m,i,p_nek_loc,is)
   55.    
   56.               enddo ! i
   57.            enddo ! m
   58.    
   59.         enddo ! p_nek
   60.    !$omp end parallel
   61.         !-----------------------------------------------------
   62.    
   63.         !-----------------------------------------------
   64.         ! Step 3:
   65.         ! 
   66.         ! Implicit collision solve:
   67.         !
   68.         ! Permute p_nek,i -> p_ine,k
   69.         n_i = n_n_1*n_energy
   70.         n_j = n_lambda
   71.         n_k = n_x
   72.         n_d = parallel_dim(n_k*n_i,n_proc_1)
   73.         !
   74.         call gyro_timer_out('Coll.-step')
   75.         call gyro_timer_in('Coll.-comm')
   76.         !
   77.         call rTRANSP_INIT(n_i,n_j,n_k,n_stack,NEW_COMM_1)
   78.         call rTRANSP_DO(f_coll,h_c)
   79.         call rTRANSP_CLEANUP
   80.         !
   81.         call gyro_timer_out('Coll.-comm')
   82.         call gyro_timer_in('Coll.-step')
   83.         !
   84.         ! Crank-Nicholson advance of H.
   85.         !
   86.         call gyro_collision_kernel(ic)
   87.         !
   88.         ! Permute p_ine,k -> p_nek,i
   89.         n_i = n_x
   90.         n_j = n_n_1*n_energy
   91.         n_k = n_lambda
   92.         n_d = parallel_dim(n_j*n_k,n_proc_1)
   93.         !
   94.         call gyro_timer_out('Coll.-step')
   95.         call gyro_timer_in('Coll.-comm')
   96.         !
   97.         call fTRANSP_INIT(n_i,n_j,n_k,n_stack,NEW_COMM_1)
   98.         call fTRANSP_DO(h_c,fb_coll)
   99.         call fTRANSP_CLEANUP
  100.         !
  101.         call gyro_timer_out('Coll.-comm')
  102.         call gyro_timer_in('Coll.-step')
  103.         !
  104.         ! NOW:
  105.         !
  106.         ! f_coll  = H = h+Psi
  107.         ! fb_coll = H_new 
  108.         !------------------------------------------------
  109.    
  110.         !-------------------------------------------------------- 
  111.         ! Step 4:
  112.         !
  113.         ! Correct for small amount of particle nonconservation.
  114.         ! This avoids a weak long-wavelength instability for n=0.
  115.         !
  116.         if (is < indx_e .and. electron_method /= 3) then
  117.            ! Total conservation
  118.            fb_coll(:,:,:) = fb_coll(:,:,:)-f_coll(:,:,:)
ftn-6262 ftn: VECTOR GYRO_COLLISION_MAIN, File = gyro_collision_main.f90, Line = 118 
  A loop starting at line 118 was not vectorized because it contains a call to a subroutine or function on line 118.

  119.            call gyro_conserve_all
  120.            h(:,:,:,is) =  h(:,:,:,is)+fb_coll(:,:,:)
ftn-6262 ftn: VECTOR GYRO_COLLISION_MAIN, File = gyro_collision_main.f90, Line = 120 
  A loop starting at line 120 was not vectorized because it contains a call to a subroutine or function on line 120.

  121.         endif
  122.         if (is == indx_e) then 
  123.            ! Number conservation
  124.            h(:,:,:,is) = h(:,:,:,is)+fb_coll(:,:,:)-f_coll(:,:,:)
ftn-6262 ftn: VECTOR GYRO_COLLISION_MAIN, File = gyro_collision_main.f90, Line = 124 
  A loop starting at line 124 was not vectorized because it contains a call to a subroutine or function on line 124.

  125.            call gyro_conserve_number
  126.         endif
  127.         !
  128.         !--------------------------------------------------------
  129.    
  130.         !---------------------
  131.         ! END Collision step
  132.         !---------------------
  133.    
  134.         call gyro_timer_out('Coll.-step')
  135.    
  136.      enddo
  137.    
  138.      if (debug_flag == 1 .and. i_proc == 0) then
  139.         print *,'[gyro_collision_main done]'
  140.      endif
  141.    
  142.    end subroutine gyro_collision_main
ftn-5001 ftn: NOTE GYRO_COLLISION_MAIN, File = gyro_collision_main.f90, Line = 142 
  Local variable "N_D" is assigned a value but never used.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                         E x t e r n a l   R e p o r t
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Name  Messages
----  --------
CHAR(Intrinsic)
      Defined as:  No definitions.

                   No calls.  It is not called and does not use any procedure.

      Interface:   None

Name  Messages
----  --------
FTRANSP_CLEANUP
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_COLLISION_MAIN (Line 99, file gyro_collision_main.f90)

Name  Messages
----  --------
FTRANSP_DO
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_COLLISION_MAIN (Line 98, file gyro_collision_main.f90)

Name  Messages
----  --------
FTRANSP_INIT
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_COLLISION_MAIN (Line 97, file gyro_collision_main.f90)

Name  Messages
----  --------
GYRO_COLLISION_KERNEL
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_COLLISION_MAIN (Line 86, file gyro_collision_main.f90)

Name  Messages
----  --------
GYRO_COLLISION_MAIN
      Defined as:  Subroutine (line 8, file gyro_collision_main.f90)

      Interface:   None

      Calls:       PARALLEL_DIM (Line 72, file gyro_collision_main.f90)
                   PARALLEL_DIM (Line 92, file gyro_collision_main.f90)
                   GYRO_TIMER_OUT (Line 74, file gyro_collision_main.f90)
                   GYRO_TIMER_OUT (Line 81, file gyro_collision_main.f90)
                   GYRO_TIMER_OUT (Line 94, file gyro_collision_main.f90)
                   GYRO_TIMER_OUT (Line 101, file gyro_collision_main.f90)
                   GYRO_TIMER_OUT (Line 134, file gyro_collision_main.f90)
                   GYRO_TIMER_IN (Line 75, file gyro_collision_main.f90)
                   GYRO_TIMER_IN (Line 82, file gyro_collision_main.f90)
                   GYRO_TIMER_IN (Line 95, file gyro_collision_main.f90)
                   GYRO_TIMER_IN (Line 102, file gyro_collision_main.f90)
                   RTRANSP_INIT (Line 77, file gyro_collision_main.f90)
                   RTRANSP_DO (Line 78, file gyro_collision_main.f90)
                   RTRANSP_CLEANUP (Line 79, file gyro_collision_main.f90)
                   GYRO_COLLISION_KERNEL (Line 86, file gyro_collision_main.f90)
                   FTRANSP_INIT (Line 97, file gyro_collision_main.f90)
                   FTRANSP_DO (Line 98, file gyro_collision_main.f90)
                   FTRANSP_CLEANUP (Line 99, file gyro_collision_main.f90)
                   GYRO_CONSERVE_ALL (Line 119, file gyro_collision_main.f90)
                   GYRO_CONSERVE_NUMBER (Line 125, file gyro_collision_main.f90)

        Uses:      GYRO_GLOBALS
                   GYRO_POINTERS
                   OMPDATA

Name  Messages
----  --------
GYRO_CONSERVE_ALL
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_COLLISION_MAIN (Line 119, file gyro_collision_main.f90)

Name  Messages
----  --------
GYRO_CONSERVE_NUMBER
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_COLLISION_MAIN (Line 125, file gyro_collision_main.f90)

Name  Messages
----  --------
GYRO_GLOBALS
      Defined as:  No definitions.

      Used By:     GYRO_COLLISION_MAIN

Name  Messages
----  --------
GYRO_POINTERS
      Defined as:  No definitions.

      Used By:     GYRO_COLLISION_MAIN

Name  Messages
----  --------
GYRO_TIMER_IN
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_COLLISION_MAIN (Line 75, file gyro_collision_main.f90)
                   GYRO_COLLISION_MAIN (Line 82, file gyro_collision_main.f90)
                   GYRO_COLLISION_MAIN (Line 95, file gyro_collision_main.f90)
                   GYRO_COLLISION_MAIN (Line 102, file gyro_collision_main.f90)

Name  Messages
----  --------
GYRO_TIMER_OUT
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_COLLISION_MAIN (Line 74, file gyro_collision_main.f90)
                   GYRO_COLLISION_MAIN (Line 81, file gyro_collision_main.f90)
                   GYRO_COLLISION_MAIN (Line 94, file gyro_collision_main.f90)
                   GYRO_COLLISION_MAIN (Line 101, file gyro_collision_main.f90)
                   GYRO_COLLISION_MAIN (Line 134, file gyro_collision_main.f90)

Name  Messages
----  --------
OMPDATA
      Defined as:  No definitions.

      Used By:     GYRO_COLLISION_MAIN

Name  Messages
----  --------
PARALLEL_DIM
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_COLLISION_MAIN (Line 72, file gyro_collision_main.f90)
                   GYRO_COLLISION_MAIN (Line 92, file gyro_collision_main.f90)

Name  Messages
----  --------
RTRANSP_CLEANUP
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_COLLISION_MAIN (Line 79, file gyro_collision_main.f90)

Name  Messages
----  --------
RTRANSP_DO
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_COLLISION_MAIN (Line 78, file gyro_collision_main.f90)

Name  Messages
----  --------
RTRANSP_INIT
      Defined as:  No definitions.

      Interface:   None

      Called By:   GYRO_COLLISION_MAIN (Line 77, file gyro_collision_main.f90)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
